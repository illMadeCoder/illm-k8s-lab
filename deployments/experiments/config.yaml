# Experiment Framework Configuration
# Controls which experiments run and on what environments

apiVersion: experiments.illm.io/v1alpha1
kind: ExperimentConfig
metadata:
  name: illm-k8s-lab-experiments

spec:
  # Global settings
  global:
    defaultEnvironment: minikube
    repository:
      url: https://github.com/illMadeCoder/illm-k8s-lab.git
      branch: main
    artifacts:
      backend: minio
      bucket: experiments
      endpoint: minio.minio.svc:9000

  # Environment definitions
  environments:
    minikube:
      description: Local Minikube cluster for development
      type: local
      terraform:
        module: minikube
        autoProvision: false  # Assumes minikube already running
      kubernetes:
        context: minikube
      resourceMultiplier: 0.5

    proxmox:
      description: Proxmox VE virtualized cluster
      type: virtualized
      terraform:
        module: proxmox
        autoProvision: true
        variables:
          node_count: 3
          node_memory: 8192
          node_cpu: 4
      kubernetes:
        context: proxmox-k8s
      resourceMultiplier: 1.0

    baremetal:
      description: Bare metal Kubernetes cluster
      type: baremetal
      terraform:
        module: baremetal
        autoProvision: false  # Manual provisioning
      kubernetes:
        context: baremetal-k8s
      resourceMultiplier: 1.5

    cloud:
      description: Cloud-managed Kubernetes (EKS/GKE/AKS)
      type: cloud
      terraform:
        module: cloud
        autoProvision: true
        variables:
          provider: aws
          region: us-west-2
          node_count: 3
          node_type: t3.large
      kubernetes:
        context: cloud-k8s
      resourceMultiplier: 2.0

  # Experiment selections
  experiments:
    enabled:
      - name: http-baseline
        environment: minikube
        schedule:
          enabled: false

    disabled: []

    groups:
      - name: smoke-tests
        description: Quick validation tests
        experiments:
          - http-baseline

  # Workflow configuration
  workflow:
    namespace: argo-workflows
    serviceAccount: argo-workflow
    defaults:
      activeDeadlineSeconds: 3600  # 1 hour max
      ttlStrategy:
        secondsAfterCompletion: 86400  # 24 hours

  # Manifest dependencies (maps to /manifests/)
  manifests:
    basePath: manifests
    dependencies:
      observability:
        - kube-prometheus-stack
        - loki
        - promtail
      loadTesting:
        - locust
      chaos:
        - chaos-mesh
      storage:
        - minio
